import os
import json
from openai import AzureOpenAI


whisper_model = "whi-td"
gpt_model = "gpt-4"

client=AzureOpenAI(
    api_key=os.getenv("AZURE_OPENAI_API_KEY"),
    api_version="2024-02-01",
    azure_endpoint=os.getenv("AZURE_OPENAI_ENDPOINT")
)

print("Current working directory:", os.getcwd())


audio_test_file = "./test.wav"

result=client.audio.transcriptions.create(
    file=open(audio_test_file, "rb"),
    model=whisper_model
)


template_summary = """
{
    "CustomerName":,
    "GeographicalLocation":,
    "ProductOfInterest":
}
"""

system_prompt = (
    "From the following call transcript, please return the required information in the template provided after the call transcript:"
    f"\n\nCall Transcript:\n{result}"
    f"\n\nTemplate:\n{template_summary}")


#Make a call to the ChatCompletion API to get the template filled
deployment_id = "gpt-4"
result = client.chat.completions.create(
    model=gpt_model,
    messages=[
        {"role":"system", "content":system_prompt}
    ],
    max_tokens=500
)



print(result.choices[0].message.content)